# Тестовое задание

## Общая информация

- Приложения разработаны на платформе NET6.
- Nullable reference types включены.
- Для написания модульных тестов использовалась библиотека XUnit.
- Для написания бенчмарков использовалась библиотека BenchmarkDotNet.

## Задача 1

### Комментарии к решению

Возможно это нужно было уточнить, т.к. это явно не указано в условии, но при решении я руководствовался следующими соображениями:

- Если валидные (соотвествующие всем условиям) диапазоны пересекают друг друга, то в результате получается максимум один валидный диапозон.  
  Например:
  - [5...15] и [10...15] => [5...15], при этом если [5...15] не валидный => [10...15]
  - [5...15] и [10...20] => [5...15], при этом если [5...15] не валидный => [10...20]
- В условии не указано должны ли сравнения быть Case Sensitive, поэтому была реализована поддержку обоих вариантов (`StreamScanParams.IgnoreCase : bool`),  
  т.к. это довольно полезно.

### Результаты Бенчмарков

Основными целями написания бенчмарков были:
- Сравнение производительности различных реализаций сканеров потоков
- Примерная оценка скорости обработки потока данных

Сводная таблица результатов бенчмарков:

|                            Method | BufferSize |                                            testData |      Mean | Ratio |   Gen0 |   Gen1 | Allocated | Alloc Ratio |
|---------------------------------- |----------- |---------------------------------------------------- |----------:|------:|-------:|-------:|----------:|------------:|
|                    **ScannerOnSpans** |        **256** | **TD1_МалыйЧастыйДиапазон_ПростоеРегВыр: (4688 bytes)** |  **25.01 μs** |    **0.00** | **0.6714** |      **-** |   **33.8 KB** |        **1.00** |
|    ScannerOnSpansWithStreamReader |        256 | TD1_МалыйЧастыйДиапазон_ПростоеРегВыр: (4688 bytes) |  24.31 μs |  0.97 | 0.4883 |      - |   25.4 KB |        0.75 |
|            ScannerOnStringBuilder |        256 | TD1_МалыйЧастыйДиапазон_ПростоеРегВыр: (4688 bytes) |  31.43 μs |  1.26 | 1.5869 |      - |   79.7 KB |        2.36 |
| ScannerOnStringBuilderWithIndexOf |        256 | TD1_МалыйЧастыйДиапазон_ПростоеРегВыр: (4688 bytes) |  55.46 μs |  2.22 | 0.7324 |      - |  37.39 KB |        1.11 |
|                                   |            |                                                     |           |       |        |        |           |             |
|                    **ScannerOnSpans** |        **256** |     **TD2_БольшойДиапазон_ПростоеРегВыр: (4670 bytes)** |  **46.79 μs** |    **0.00** | **0.7324** |      **-** |  **36.27 KB** |        **1.00** |
|    ScannerOnSpansWithStreamReader |        256 |     TD2_БольшойДиапазон_ПростоеРегВыр: (4670 bytes) |  48.18 μs |  1.03 | 0.5493 |      - |  27.89 KB |        0.77 |
|            ScannerOnStringBuilder |        256 |     TD2_БольшойДиапазон_ПростоеРегВыр: (4670 bytes) |  51.76 μs |  1.11 | 1.7700 |      - |  89.13 KB |        2.46 |
| ScannerOnStringBuilderWithIndexOf |        256 |     TD2_БольшойДиапазон_ПростоеРегВыр: (4670 bytes) | 111.25 μs |  2.38 | 0.6104 |      - |  29.94 KB |        0.83 |
|                                   |            |                                                     |           |       |        |        |           |             |
|                    **ScannerOnSpans** |        **256** | **TD3_МалыйЧастыйДиапазон_СложноеРегВыр: (4770 bytes)** |  **27.36 μs** |    **0.00** | **0.6714** |      **-** |  **33.26 KB** |        **1.00** |
|    ScannerOnSpansWithStreamReader |        256 | TD3_МалыйЧастыйДиапазон_СложноеРегВыр: (4770 bytes) |  28.53 μs |  1.04 | 0.4883 |      - |  24.69 KB |        0.74 |
|            ScannerOnStringBuilder |        256 | TD3_МалыйЧастыйДиапазон_СложноеРегВыр: (4770 bytes) |  32.08 μs |  1.17 | 1.5869 |      - |  79.43 KB |        2.39 |
| ScannerOnStringBuilderWithIndexOf |        256 | TD3_МалыйЧастыйДиапазон_СложноеРегВыр: (4770 bytes) |  58.18 μs |  2.13 | 0.7324 |      - |  36.98 KB |        1.11 |
|                                   |            |                                                     |           |       |        |        |           |             |
|                    **ScannerOnSpans** |        **256** |     **TD4_БольшойДиапазон_СложноеРегВыр: (4745 bytes)** |  **47.38 μs** |    **0.00** | **0.7324** |      **-** |  **37.13 KB** |        **1.00** |
|    ScannerOnSpansWithStreamReader |        256 |     TD4_БольшойДиапазон_СложноеРегВыр: (4745 bytes) |  49.05 μs |  1.04 | 0.5493 |      - |  28.62 KB |        0.77 |
|            ScannerOnStringBuilder |        256 |     TD4_БольшойДиапазон_СложноеРегВыр: (4745 bytes) |  49.92 μs |  1.05 | 1.7700 |      - |  89.14 KB |        2.40 |
| ScannerOnStringBuilderWithIndexOf |        256 |     TD4_БольшойДиапазон_СложноеРегВыр: (4745 bytes) | 111.35 μs |  2.35 | 0.4883 |      - |  28.36 KB |        0.76 |
|                                   |            |                                                     |           |       |        |        |           |             |
|                    **ScannerOnSpans** |       **1024** | **TD1_МалыйЧастыйДиапазон_ПростоеРегВыр: (4688 bytes)** |  **23.69 μs** |    **0.00** | **0.6714** |      **-** |   **33.5 KB** |        **1.00** |
|    ScannerOnSpansWithStreamReader |       1024 | TD1_МалыйЧастыйДиапазон_ПростоеРегВыр: (4688 bytes) |  24.52 μs |  1.03 | 0.5798 |      - |  28.42 KB |        0.85 |
|            ScannerOnStringBuilder |       1024 | TD1_МалыйЧастыйДиапазон_ПростоеРегВыр: (4688 bytes) |  32.86 μs |  1.39 | 2.8687 | 0.0610 | 142.38 KB |        4.25 |
| ScannerOnStringBuilderWithIndexOf |       1024 | TD1_МалыйЧастыйДиапазон_ПростоеРегВыр: (4688 bytes) |  52.60 μs |  2.22 | 0.7324 |      - |  36.08 KB |        1.08 |
|                                   |            |                                                     |           |       |        |        |           |             |
|                    **ScannerOnSpans** |       **1024** |     **TD2_БольшойДиапазон_ПростоеРегВыр: (4670 bytes)** |  **32.35 μs** |    **0.00** | **0.4883** |      **-** |   **25.2 KB** |        **1.00** |
|    ScannerOnSpansWithStreamReader |       1024 |     TD2_БольшойДиапазон_ПростоеРегВыр: (4670 bytes) |  33.14 μs |  1.02 | 0.3662 |      - |  20.15 KB |        0.80 |
|            ScannerOnStringBuilder |       1024 |     TD2_БольшойДиапазон_ПростоеРегВыр: (4670 bytes) |  36.05 μs |  1.11 | 1.4648 |      - |  74.12 KB |        2.94 |
| ScannerOnStringBuilderWithIndexOf |       1024 |     TD2_БольшойДиапазон_ПростоеРегВыр: (4670 bytes) |  72.65 μs |  2.25 | 0.4883 |      - |  29.64 KB |        1.18 |
|                                   |            |                                                     |           |       |        |        |           |             |
|                    **ScannerOnSpans** |       **1024** | **TD3_МалыйЧастыйДиапазон_СложноеРегВыр: (4770 bytes)** |  **25.66 μs** |    **0.00** | **0.6714** |      **-** |  **33.05 KB** |        **1.00** |
|    ScannerOnSpansWithStreamReader |       1024 | TD3_МалыйЧастыйДиапазон_СложноеРегВыр: (4770 bytes) |  26.11 μs |  1.02 | 0.5493 |      - |  27.81 KB |        0.84 |
|            ScannerOnStringBuilder |       1024 | TD3_МалыйЧастыйДиапазон_СложноеРегВыр: (4770 bytes) |  33.26 μs |  1.30 | 2.8076 |      - | 139.42 KB |        4.22 |
| ScannerOnStringBuilderWithIndexOf |       1024 | TD3_МалыйЧастыйДиапазон_СложноеРегВыр: (4770 bytes) |  59.46 μs |  2.32 | 0.6714 |      - |  35.87 KB |        1.09 |
|                                   |            |                                                     |           |       |        |        |           |             |
|                    **ScannerOnSpans** |       **1024** |     **TD4_БольшойДиапазон_СложноеРегВыр: (4745 bytes)** |  **32.79 μs** |   **0.00** | **0.4883** |      **-** |  **25.31 KB** |        **1.00** |
|    ScannerOnSpansWithStreamReader |       1024 |     TD4_БольшойДиапазон_СложноеРегВыр: (4745 bytes) |  33.49 μs |  1.02 | 0.3662 |      - |  20.12 KB |        0.79 |
|            ScannerOnStringBuilder |       1024 |     TD4_БольшойДиапазон_СложноеРегВыр: (4745 bytes) |  33.81 μs |  1.03 | 1.4648 |      - |   74.6 KB |        2.95 |
| ScannerOnStringBuilderWithIndexOf |       1024 |     TD4_БольшойДиапазон_СложноеРегВыр: (4745 bytes) |  72.42 μs |  2.21 | 0.6104 |      - |  32.32 KB |        1.28 |

Где **ScannerOnSpans** (`DefaultStreamScanner`) - это реализация, которая используется в основном коде.  
В среднем эта реализация дает лучшие результаты.  
В худшем из рассмотренных случаев (TD2) при **BufferSize = 1024** пропусную способность можно примерно оценить как:
```
(4670 Байт / 32.35 μs) = 144.3 МБ/с = 1.15 Гбит/с.
```

В лучшем из рассмотренных случаев (TD1) при **BufferSize = 1024** пропусную способность можно примерно оценить как:
```
(4688 Байт / 23.69 μs) = 198.0 МБ/с = 1.58 Гбит/с.
```

## Задача 2

### Результаты Бенчмарков

Сводная таблица результатов бенчмарков:

|                           Method | BufferSize |                testData |     Mean | Ratio |   Gen0 | Allocated | Alloc Ratio |
|--------------------------------- |----------- |------------------------ |---------:|------:|-------:|----------:|------------:|
| **StreamCleanerWithoutStreamReader** |        **256** | **test.html: (3347 bytes)** | **33.51 μs** |  **1.00** | **0.1831** |  **10.53 KB** |        **1.00** |
|    StreamCleanerWithStreamReader |        256 | test.html: (3347 bytes) | 34.54 μs |  1.03 | 0.1831 |  11.16 KB |        1.06 |
|                                  |            |                         |          |       |        |           |             |
| **StreamCleanerWithoutStreamReader** |       **1024** | **test.html: (3347 bytes)** | **33.03 μs** |  **1.00** | **0.2441** |  **12.78 KB** |        **1.00** |
|    StreamCleanerWithStreamReader |       1024 | test.html: (3347 bytes) | 33.72 μs |  1.02 | 0.2441 |  14.91 KB |        1.17 |


Где **StreamCleanerWithoutStreamReader** (`HtmlStreamCleaner`) - это реализация, которая используется в основном коде.  
В среднем эта реализация дает лучшие результаты.  
При **BufferSize = 1024** пропусную способность можно примерно оценить как:
```
(3347 Байт / 33.03 μs) = 101.3 МБ/с = 0.81 Гбит/с.
```