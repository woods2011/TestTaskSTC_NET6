# Тестовое задание

## Общая информация

- Приложения разработаны на платформе NET6.
- Nullable reference types включены.
- Для написания модульных тестов использовалась библиотека XUnit.
- Для написания бенчмарков использовалась библиотека BenchmarkDotNet.

## Задача 1

### Комментарии к решению

Возможно это нужно было уточнить, т.к. это явно не указано в условии, но при решении я руководствовался следующими соображениями:

- Если валидные (соотвествующие всем условиям) диапазоны пересекают друг друга, то в результате получается максимум один валидный диапозон.  
  Например:
  - [5...15] и [10...15] => [5...15], при этом если [5...15] не валидный => [10...15]
  - [5...15] и [10...20] => [5...15], при этом если [5...15] не валидный => [10...20]
- В условии не указано должны ли сравнения быть Case Sensitive, поэтому была реализована поддержку обоих вариантов (`StreamScanParams.IgnoreCase : bool`),  
  т.к. это довольно полезно.

### Результаты Бенчмарков

Основными целями написания бенчмарков были:
- Сравнение производительности различных реализаций сканеров потоков
- Примерная оценка скорости обработки потока данных

Сводная таблица результатов бенчмарков:

|                    Method | BufferSize | testData                                                                           |      Mean | Ratio |    Allocated | Alloc Ratio |
|-------------------------- |----------- |------------------------------------------------------------------------------------|----------:|------:|-------------:|------------:|
|      **DefaultStreamScanner** |       **4096** | **TD1_200МБ_ИзВашегоПисьма_ОдинБольшойДиапазон:<br/> (209715.2 KB)**           | **195.31 ms** |  **1.00** |    **257.61 KB** |        **1.00** |
| SimpleGreedyStreamScanner |       4096 | TD1_200МБ_ИзВашегоПисьма_ОдинБольшойДиапазон:<br/> (209715.2 KB)                   | 195.19 ms |  1.00 |    257.59 KB |        1.00 |
|                           |            |                                                                                    |           |       |              |             |
|      **DefaultStreamScanner** |       **4096** | **TD2_200МБ_ОченьМногоДиапазонов(Валидных&lt;Невалидных):<br/> (209715.2 KB)** | **343.71 ms** |  **1.00** | **224467.07 KB** |        **1.00** |
| SimpleGreedyStreamScanner |       4096 | TD2_200МБ_ОченьМногоДиапазонов(Валидных&lt;Невалидных):<br/> (209715.2 KB)      | 280.31 ms |  0.82 |  67852.42 KB |        0.30 |
|                           |            |                                                                                    |           |       |              |             |
|      **DefaultStreamScanner** |      **16384** | **TD1_200МБ_ИзВашегоПисьма_ОдинБольшойДиапазон:<br/> (209715.2 KB)**           |  **72.14 ms** |  **1.00** |    **275.34 KB** |        **1.00** |
| SimpleGreedyStreamScanner |      16384 | TD1_200МБ_ИзВашегоПисьма_ОдинБольшойДиапазон:<br/> (209715.2 KB)                |  71.31 ms |  0.99 |    275.35 KB |        1.00 |
|                           |            |                                                                                    |           |       |              |             |
|      **DefaultStreamScanner** |      **16384** | **TD2_200МБ_ОченьМногоДиапазонов(Валидных&lt;Невалидных):<br/> (209715.2 KB)**  | **192.06 ms** |  **1.00** | **211187.55 KB** |        **1.00** |
| SimpleGreedyStreamScanner |      16384 | TD2_200МБ_ОченьМногоДиапазонов(Валидных&lt;Невалидных):<br/> (209715.2 KB)      | 152.20 ms |  0.79 |  69922.54 KB |        0.33 |

Где **ScannerOnSpans** (`DefaultStreamScanner`) - это новая реализация, которая используется в основном коде.  
По скорости и памяти эта реализация уступает `SimpleGreedyStreamScanner`, но обрабатывает больше граничных случаев.  
Все тестовые прогоны были CaseSensitive.  
Файл каждый раз читался заново.  
В худшем из рассмотренных случаев (TD2) при **BufferSize = 4096** пропусную способность `DefaultStreamScanner` можно примерно оценить как:
```
(209715.2 KB / 343.71 ms) = 610.1 МБ/с = 4.880 Гбит/с.
```

В лучшем из рассмотренных случаев (TD1) при **BufferSize = 4096** пропусную способность можно примерно оценить как:
```
(209715.2 KB / 72.14 ms) = 2907.0 МБ/с = 23.256 Гбит/с.
```

## Задача 2

### Результаты Бенчмарков

Сводная таблица результатов бенчмарков:

|           Method | BufferSize |                testData |     Mean |        Ratio | Allocated | Alloc Ratio |
|----------------- |----------- |------------------------ |---------:|-------------:|----------:|------------:|
| **NewStreamCleaner** |        **256** | **test.html: (3347 bytes)** | **12.86 μs** |  **1.00** |   **7.27 KB** |        **1.00** |
| OldStreamCleaner |        256 | test.html: (3347 bytes) | 32.73 μs |         2.54 |  10.53 KB |        1.45 |
|                  |            |                         |          |              |           |             |
| **NewStreamCleaner** |       **1024** | **test.html: (3347 bytes)** | **12.42 μs** |  **1.00** |  **8.02 KB** |        **1.00** |
| OldStreamCleaner |       1024 | test.html: (3347 bytes) | 33.41 μs |         2.69 |  12.78 KB |        1.59 |
|                  |            |                         |          |              |           |             |
| **NewStreamCleaner** |       **4096** | **test.html: (3347 bytes)** | **11.83 μs** |  **1.00** |  **11.02 KB** |        **1.00** |
| OldStreamCleaner |       4096 | test.html: (3347 bytes) | 32.50 μs |         2.75 |  21.71 KB |        1.97 |

Где **NewStreamCleaner** (`NewHtmlStreamCleaner`) - это новая реализация, которая используется в основном коде.  
Эта реализация дает намного лучшие результаты.  
При **BufferSize = 1024** пропусную способность можно примерно оценить как:
```
(3347 Байт / 12.42 μs) = 269.48 МБ/с = 2.155 Гбит/с.
```